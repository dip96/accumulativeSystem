# Выпускной проект по Go

## Библиотеки
- [Сhi](https://github.com/go-chi/chi) - роутер
- [Jwtauth](https://github.com/go-chi/jwtauth) - библиотека для работы с jwt токеном
- [Logrus](https://github.com/sirupsen/logrus) - библиотека для работы с логами
- [pgx](https://github.com/jackc/pgx) - библиотека для работы с бд(Postgres)
- [golang-migrate](https://github.com/golang-migrate/migrate) - библиотека для работы с миграциями
- библиотека с шифрованием (sha)

## База данных


### Таблица "users"


| Колонка | Тип данных  | Описание |
|---------|-------------|-----------|
| id         | INT         | Уникальный идентификатор пользователя |
| login      | VARCHAR(50) | Имя пользователя (Уникальное, индекс) |
| password   | binary      | Пароль пользователя |
| created_at | TIMESTAMP   | Дата создания пользователя |

password binary

### Таблица "orders"


| Колонка | Тип данных | Описание                        |
|---------|------------|---------------------------------|
| id         | INT        | Уникальный идентификатор заказа |
| user_id    | INT        | Ид пользователя (индекс)        |
| number     | INT        | ID Заказа (Уникальное, индекс)  |
| accrual    | float OR numeric  | Баллы                           |
| status     | ENUM       | Статус                          |
| created_at | TIMESTAMP  | Дата создания пользователя      |

accrual - float, numeric
status - тип enum postgres 

минусы:
модель данных не проработана
проект не расширяем

go метод в хендлер - POST /api/user/orders при обращении

### Связь между таблицами


Таблица `orders` имеет внешний ключ `user_id`, который ссылается на первичный ключ `id` в таблице `users`.
Отношение "один ко многим" (one-to-many), где один пользователь может иметь множество заказов.


## Шаг 1.
### Регистрация, аутентификация и авторизация пользователей


### **Регистрация пользователя**


```
Регистрация производится по паре логин/пароль. Каждый логин должен быть уникальным.
После успешной регистрации должна происходить автоматическая аутентификация пользователя.
```


**Запрос**
`POST /api/user/register`


**Заголовки**
```
Accept: application/json
```


**Тело запроса**
```json
{
"login":"login",
"password": "password"
}
```


**Коды ответа**


**Заголовки**
```
Accept: application/json
```


#### Успешные ответы


- `200 OK` - пользователь успешно зарегистрирован и аутентифицирован


#### Ошибки клиента


- `400 Bad Request` - неверный формат запроса
- `409` - логин уже занят
- `500` - внутренняя ошибка сервера


-----------------------------------------------------


### Аутентификация пользователя


```
Аутентификация производится по паре логин/пароль.
Для передачи аутентификационных данных используйте механизм cookies или HTTP-заголовок Authorization.
```


**Запрос**
`POST /api/user/login`


**Заголовки**
```
Accept: application/json
```


**Тело запроса**
```json
{
"login":"login",
"password": "password"
}
```


**Коды ответа**


**Заголовки**
```
Accept: application/json
Authorization: Bearer token
```


#### Успешные ответы


- `200 OK` - пользователь успешно аутентифицирован


#### Ошибки клиента


- `400 Bad Request` - неверный формат запроса
- `401 ` - неверная пара логин/пароль
- `500 ` - внутренняя ошибка сервера




## Структура проекта

├── cmd  
│   ├── accrual  
│   │   ├── accrual_darwin_amd64  
│   │   ├── accrual_darwin_arm64  
│   │   ├── accrual_linux_amd64  
│   │   └── accrual_windows_amd64  
│   └── gophermart  
│       ├── README.md  
│       └── main.go  
├── internal  
│   ├── config  
│   │   └── config.go  
│   ├── migrator  
│   ├── model  
│   │   ├── orders  
│   │   └── users  
│   └── README.md  
├── migrations  
│   └── README.md  
├── .gitignore  
├── README.md  
├── SPECIFICATION.md  
├── go.mod  
├── tree.md  
└── tz.md  